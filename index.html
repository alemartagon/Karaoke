<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Traduzione Vocale: Spagnolo → Italiano</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #f4f4f4;
      margin: 0;
    }
    .container {
      text-align: center;
      max-width: 800px;
      padding: 2rem;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      border-radius: 1rem;
    }
    .phrase {
      font-size: 1.5rem;
      line-height: 2.2rem;
      margin-bottom: 1.5rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="phrase" id="text">Inizia a parlare in spagnolo...</div>
  </div>

  <script>
    const frasesEsp = [
      "Buenos días a todos. Antes de comenzar, quiero agradecer al tribunal su presencia hoy aquí, al igual que agradezco a mis directoras y tutor la ayuda que me han brindado durante el desarrollo de este trabajo.",
      "Aunque me gustaría hablaros de este proyecto durante horas, debo acogerme al tiempo establecido así que intentaré ser breve, clara y concisa, de forma que todos podáis apreciar el aporte que supone este trabajo independientemente de los conocimientos que tiene cada uno sobre la entonación y sobre los dialectos sicilianos."
    ];

    const frasesIta = [
      "Buongiorno a tutti. Prima di cominciare, vorrei ringraziare il tribunale per la sua presenza oggi qui, così come ringrazio le mie direttrici e il mio tutor per l’aiuto che mi hanno offerto durante lo sviluppo di questo lavoro.",
      "Anche se mi piacerebbe parlarvi di questo progetto per ore, devo rispettare il tempo stabilito, quindi cercherò di essere breve, chiara e concisa, in modo che tutti possiate cogliere il contributo di questo lavoro indipendentemente dalle conoscenze che ciascuno ha sull’intonazione e sui dialetti siciliani."
    ];

    const textEl = document.getElementById("text");
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition, lastMatch = -1;

    if (!SpeechRecognition) {
      textEl.textContent = "Tu navegador no soporta reconocimiento de voz.";
    } else {
      recognition = new SpeechRecognition();
      recognition.lang = 'es-ES';
      recognition.interimResults = false;
      recognition.continuous = true;

      recognition.onresult = (event) => {
        const transcript = event.results[event.results.length - 1][0].transcript.trim().toLowerCase();
        const matchIndex = frasesEsp.findIndex((f, i) => i > lastMatch && transcript.includes(f.slice(0, 15).toLowerCase()));

        if (matchIndex !== -1) {
          textEl.textContent = frasesIta[matchIndex];
          lastMatch = matchIndex;
        }
      };

      recognition.onerror = (e) => {
        console.error("Speech recognition error:", e);
        recognition.stop();
        setTimeout(() => recognition.start(), 1000); // restart after delay
      };

      recognition.onend = () => {
        setTimeout(() => recognition.start(), 500); // keep listening
      };

      recognition.start();
    }
  </script>
</body>
</html>

